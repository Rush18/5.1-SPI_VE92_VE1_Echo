# 5.1-SPI_VE92_VE1_Echo

Пример работы с блоком SPI. Реализован для отладочных плат микроконтроллеров Миландр 1986ВЕ1Т и 1986ВЕ92У. www.milandr.ru

По умолчанию в проекте 1986ВЕ2У выбран мастером, 1986ВЕ1Т - ведомым. Мастер посылает значения ведомому, которые возращает их обратно. 
Оба микроконтроллера сравнивают пришедшие значения с ожидаемыми и считают ошибки за определенный период. 
  - Если ошибок за период нет, то переключается один светодиод.
  - Если ошибки за период были, то переключаются оба светодиода.

Макроопределениями в main.c можно поменять кто будет ведущим, а кто ведомым.

Является реализацией данной статьи - https://startmilandr.ru/doku.php/prog:spi:ve1_ve92

UPD: Пример был модифицирован для проверки работы без использование сигнала FSS. Это возможно только в режиме SPH = 1. FSS ведомого должен быть подключен к земле, чтобы вывести линию MISO из 3-го состояния. В данном случае ведомый выдвигает биты только по сигналу CLK, поэтому необходимо подтянуть линию CLK к земле. Поскольку если мастер еще не вывел на линию CLK в 0, то линия висит в воздухе и ловит наводки. Соответственно ведомый при выходе сигнала из логического 0, может вывести один или несколько бит. А когда мастер начнет передачу, количество бит в посылке у них не совпадет.

Пример адаптирован для запуска по одновременной подаче питания на обе отладочные платы. (Платы необходимо воткнуть в один пульт и включать одновременно.) В мастере вставлена задержка, чтобы ведомый заведомо был готов к работе, когда мастер начнет обмен.